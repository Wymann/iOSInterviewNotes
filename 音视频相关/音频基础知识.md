## 音频基础知识

### 1 基础概念

#### 1.1 音频的量化与编码

现实生活中，我们听到的声音都是时间连续的，我们把这种信号叫模拟信号。模拟信号（连续信号）需要量化成数字信号（离散的、不连续的信号）以后才能在计算机中使用。分为5个步骤：

**模拟信号**

连续平滑的波形，横坐标为时间轴，纵坐标表示声音的强弱。

**采样**

按照一定的时间间隔在连续的波上进行采样取值，如下图所示取了10个样。

**量化**

将采样得到的值进行量化处理，也就是给纵坐标定一个刻度，记录下每个采样的纵坐标的值。

**编码**

将每个量化后的样本值转换成二进制编码。

**数字信号**

将所有样本二进制编码连起来存储在计算机上就形成了数字信号。

![](https://github.com/tangshenghao/iOSInterviewNotes/blob/master/%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3/%E9%9F%B3%E9%A2%91%E9%87%8F%E5%8C%96%E8%BF%87%E7%A8%8B.jpeg?raw=true)

#### 1.2 量化的基本概念

**采样大小**

一个采样用多少个bit存放，常用的是16bit（这就意味着上述的量化过程中，纵坐标的取值范围是0-65535，声音是没有负值的）。

**采样率**

1秒采样次数，采样频率，一般采样率有8、16、32、44.1、48KHz等，采样率越高，声音的还原就越真实自然，当然数据就越大。

模拟信号中，人类听觉是20-20000Hz，如果按照44.1kHz频率进行采样，对20Hz音频进行采样，一个正玄波采样2200次；对20000Hz音频进行采样，平均一个正玄波采样2.2次。

**声道数**

为了播放声音时能够还原真实的声场，在录制时前后左右不同的方位同时获取声音，每个方位的声音就是一个声道。一般有单声道、双声道、多声道。

**码率**

也叫比特率，是每秒传送的bit数，单位为bps（Bit Per Second），比特率越高，每秒传送数据就越多，音质就越好。

码率计算公式：

码率 = 采样率 * 采样大小 * 声道数

比如采样率44.1kHz，采样大小为16bit，双声道PCM编码的WAV文件：

码率 = 44.1kHz * 16bit * 2 = 1411.2kbit/s

那么录制1分钟的音乐大小为（1411.2 * 1000 * 60）/ 8 / 1024 / 1024 = 10.09M

#### 1.3 音频编码器

常见的音频编码器包括OPUS、AAC、Vorbis、Speex、G.711等。目前直播采用的rtmp协议，支持AAC和Speex。

从性能上看，OPUS > AAC > Vorbis，其他的逐渐被淘汰。

##### 1.3.1 AAC常用规格

AAC目前常用的规格有 AAC LC、AAC HE V1、AAC HE V2。

**AAC LC**

AAC LC (Low Complexity) 是低复杂度，一般码率128kbt/s。

**AAC HE V1**

AAC HE V1是在AAC LC基础上加入了SBR(Spectral Band Replication)技术，也就是分频复用，加入这种技术后使码流变得更低，而且音质更好。比如按照44.1kHz采样率，20Hz频段一个正玄波采样2200个，这太浪费了，而在20000Hz频段一个正玄波采样2.2次，采样次数太少导致音质较差。采用SBR进行分频处理，在低频段降低采样率，在高频段提高采样率，这样既能降低码率又能提高音质。AAC HE V1一般码率为64kbt/s左右。

**AAC HE V2**

AAC HE V2在AAC HE V1的基础上又增加了PS(Parametric Stereo)技术。也就是将立体声双声道分别保存，一个声道的数据完整保存，另一个声道只存储一些差异性的参数信息，因为两个声道信息相关性非常强，可以通过那些差异性参数来还原这个声道的信息。AAC HE V1一般码率为32kbt/s左右。

AAC的格式有ADIF和ADTS两种

**AAC ADIF(Audio Data Interchange Format)**

这种格式的AAC文件只在最开始的地方存有一个头，头里面包括采样率、采样大小、声道数等信息。每拿出一个音频帧都用这个头信息来进行解析。它只能从开头位置开始解码，一般用于磁盘文件中。

**AAC ADTS(Audio Data Transport Stream)**

这种格式的AAC文件在每一个音频帧的前面都有一个同步字，也就是加一个小的头(7-9个字节)，所以它可以从任何位置开始解码。它的优点就是进行流传输时每拿到一个音频帧直接就可以进行解码播放，缺点就是每个音频帧都多出一个头，所以相对于ADIF格式它会多出一些数据量。

#### 1.4 PCM格式

PCM音频数据是未经压缩的音频采样数据裸流，是数字通信的编码方式之一。主要过程是将话音、图像等模拟信号每隔一定时间进行取样，使其离散化，同时将抽样值按分层单位四舍五入取整量化，同时将抽样值按一组二进制码来表示抽样脉冲的幅值。（就是1.1节中的内容）

PCM信号未经过任何编码和压缩处理(无损压缩)。与模拟信号比，它不易受传送系统的杂波及失真的影响。动态范围宽，可得到音质相当好的效果。编码上采用A律13折线编码（G.711A）。

A律是PCM非均匀量化中的一种对数压扩形式。数字脉冲编码调制（PCM）是目前模拟信号数字化的基本方法，PCM包括采样、量化、编码三个步骤，其中量化是对抽样值的取值离散，根据量化间隔的不同选取分为均匀量化和非均匀量化，非均匀量化可以有效地改善信号的量化信噪比。语音信号的量化常采用ITU建议的两种对数形式的**非均匀量化压缩**特性：A律和U律，A律编码主要用于30/32路一次群系统，U律编码主要用于24路一次群系统。A律PCM用于欧洲和中国。U律PCM用于北美和日本。

