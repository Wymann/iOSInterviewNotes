## 多线程

### 1 基础知识

#### 1.1 进程

进程是指在系统中正在运行的一个应用程序，每个进程之间是独立的，每个进程之间是独立的，每个进程均运行在其专用且受保护的内存空间内。<br/>

#### 1.2 线程

1个进程想要执行任务，必须得有线程，也就是每1个进程至少要有1条线程，称为主线程。一个进程的所有任务都在线程中执行。<br/>

#### 1.3 进程和线程的比较

线程是CPU调用（执行任务）的最小单位。

进程是CPU分配资源的最小单位。

一个进程中至少要有一个线程。

同一个进程内的线程共享进程的资源。<br/>

#### 1.4 线程的串行

1个线程中任务的执行是串行的，如果要在1个线程中执行多个任务，那么只能一个一个按顺序执行。也就是同一时间内，1个线程只能执行1个任务。<br/>

#### 1.5 多线程

1个进程中可以开启多条线程，每条线程可以并行（同时）执行不同的任务，多线程技术可以提高程序的执行效率。<br/>

#### 1.6 多线程原理

同一时间，CPU只能处理1条线程，只有1条线程在工作（执行），多线程并发（同时）执行不同的任务，其实是CPU快速地在多条线程之间调度（切换），如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象。

如果开启的线程非常非常多，CPU会在N多线程之间调度，CPU会累死，消耗大量的CPU资源，同时每条线程被调用执行的频次也会降低（线程的执行效率降低）。<br/>

#### 1.7 多线程的优缺点

优点：

- 能适当提高程序的执行效率

- 能适当提高资源利用率（CPU、内存利用率）


缺点：

- 创建线程是有开销的，iOS下主要成本包括：内核数据结构（大约1KB）、栈空间（子线程512KB、主线程1MB，也可以使用-setStackSize：设置，但必须是4K的倍数，而且最小是16K），创建线程大约需要90毫秒的创建时间。

- 如果开启大量的线程，会降低程序的性能，线程越多，CPU在调度线程上的开销就越大。

- 程序设计更加复杂：比如线程之间的通信、多线程的数据共享等问题。


#### 1.8 多线程的应用

主线程的主要作用

显示/刷新UI界面

处理UI事件（比如点击、滚动、拖拽事件等）

主线程使用注意：

别将比较耗时的操作放到主线程中

耗时操作会卡住主线程，严重影响UI的流程度，影响用户体验。

将耗时操作放在子线程执行，然后到刷新UI时再换回主线程。<br/>







#### 1.9 iOS的4种多线程方案

| 方案        | 简介                                                         | 语言 | 线程生命周期 | 使用频率 |
| ----------- | ------------------------------------------------------------ | ---- | ------------ | -------- |
| pthread     | 一套通用的多线程API<br/>适用于Unix\Linux\Windows等系统<br/>跨平台\可移植<br/>使用难度大 | C    | 程序员管理   | 几乎不用 |
| NSThread    | 使用更加面向对象<br/>简单易用，可直接操作线程对象            | OC   | 程序员管理   | 偶尔使用 |
| GCD         | 旨在替代NSThread等线程技术                                   | C    | 自动管理     | 经常使用 |
| NSOperation | 基于GCD封装<br/>比GCD多了一些更简单实用的功能<br/>实用更加面向对象 | OC   | 自动管理     | 经常使用 |

