## 引用计数和weak实现

通过上篇的内存管理，知道了iOS的内存管理使用的是引用计数的模式，通过记录对象的引用计数管理堆上的内存，新增引用时引用计数加1，释放对象引用计数减1，然后引用计数为0时执行销毁等操作。

通过weak可以解决循环引用的问题，也就是指向对象但不增加其引用计数。最后对象销毁的时候将weak修饰的指针指向nil。

接下来说明引用计数和weak的实现。

### 1 数据结构分析

对于引用计数和weak，有三个重要的类型，分别是SideTables、RefcountMap、weak_table_t。

#### 1.1 SideTables

首先苹果创建了一个全局的SideTables，用来管理所有对象的引用计数。是一个全局的Hash表，从名称的结尾带s上看更像是个数组，也有部分文章称其为Hash数组。



